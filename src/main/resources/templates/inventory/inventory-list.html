<!DOCTYPE html>
<!-- 1. Added missing Security Namespace -->
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org">
<head>
    <!-- 2. Self-closed meta and link tags (Required by Thymeleaf parser) -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Inventory Management -CG Library</title>
    <link href="https://fonts.googleapis.com" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- 3. Fixed broken Icon CDN link -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net" />
    
    
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --bg-light: #f8f9fc;
            --danger-soft: #fff1f2;
            --danger-text: #e11d48;
            --success-soft: #f0fdf4;
            --success-text: #16a34a;
        }

        body { background-color: var(--bg-light); font-family: 'Inter', sans-serif; color: #333; }
        .navbar { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%) !important; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .navbar-brand { font-weight: 700; letter-spacing: -0.5px; }
        .main-card { border: none; border-radius: 12px; background: #ffffff; box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075); margin-top: 2rem; }
        .table thead th { font-weight: 600; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.05em; color: #64748b; padding: 1rem; background-color: #f1f5f9; }
        .btn-add { background-color: var(--primary-color); border: none; font-weight: 600; padding: 0.6rem 1.2rem; border-radius: 8px; color: white; }
        .badge-available { background-color: var(--success-soft); color: var(--success-text); }
        .badge-outofstock { background-color: var(--danger-soft); color: var(--danger-text); }
        .btn-delete-custom { color: var(--danger-text); background-color: var(--danger-soft); border: 1px solid #fee2e2; border-radius: 8px; font-weight: 500; }
        .btn-delete-custom:hover { background-color: var(--danger-text); color: white; }
    </style>
</head>
<body>
 
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#">ðŸ“š <span class="ms-2">CG Library</span></a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link text-white-50" th:href="@{/authors/list}">Authors</a>
                <a class="nav-link text-white-50" th:href="@{/books/list}">Books</a>
                <a class="nav-link active" th:href="@{/inventories/list}">Inventory</a>
                <a class="nav-link text-white-50" th:href="@{/category/list}">Categories</a>
                <a class="nav-link text-white-50" th:href="@{/publishers/list}">Publishers</a>
                <a class="nav-link text-white-50" th:href="@{/users/list}" sec:authorize="hasRole('ADMIN')">Users</a>
                    
                <!-- 4. REPAIRED: Closed the FORM tag correctly -->
                <form th:action="@{/logout}" method="post" class="ms-lg-3">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="btn btn-link nav-link text-danger border-0">Logout</button>
                </form> <!-- Added missing close tag -->
            </div>
        </div>
    </nav>
 
    <div class="container pb-5">
        <div class="card main-card p-4">
            <div class="row align-items-center mb-4">
                <div class="col-md-6">
                    <h3 class="mb-0 fw-bold" style="color: #1e293b;">Inventory Dashboard</h3>
                    <p class="text-muted small mb-0">Monitor stock levels and availability status.</p>
                </div>
                <div class="col-md-6 text-md-end mt-3 mt-md-0" sec:authorize="hasRole('ADMIN')">
                    <a th:href="@{/inventories/add}" class="btn btn-primary btn-add">
                        <i class="bi bi-plus-circle-fill me-2"></i> Add New Stock
                    </a>
                </div>
            </div>
 
            <div class="table-responsive">
                <table class="table table-borderless">
                    <thead>
                        <tr>
                            <th>Book Details</th>
                            <th>Qty</th>
                            <th>Status</th>
                            <th class="text-end">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="inv : ${inventories}" class="border-bottom">
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="rounded-circle bg-light d-flex align-items-center justify-content-center me-3" 
                                         style="width: 40px; height: 40px; color: #4361ee; font-weight: bold; font-size: 0.8rem;">
                                        <i class="bi bi-box-seam"></i>
                                    </div>
                                    <div>
                                        <!-- Displays Book Name and ID -->
<!-- Repaired line in inventory-list.html -->
<span class="fw-bold d-block text-dark" th:text="${inv.bookTitle ?: 'No Title Available'}">Book Name</span>
                                        <small class="text-muted font-monospace" th:text="${'#INV-' + inv.inventoryId}">#INV-1</small>
                                    </div>
                                </div>
                            </td>
                            <td class="fw-semibold" th:text="${inv.quantity}">0</td>
                            <td>
                                <span th:classappend="${inv.status == 'AVAILABLE' ? 'badge-available' : 'badge-outofstock'}" 
                                      class="badge px-3 py-2 rounded-pill" 
                                      th:text="${inv.status}">Status</span>
                            </td>
                            <td class="text-end" sec:authorize="hasRole('ADMIN')">
                                <div class="d-flex justify-content-end gap-2">
                                    <a th:href="@{/inventories/edit/{id}(id=${inv.inventoryId})}"
                                       class="btn btn-sm btn-outline-primary d-inline-flex align-items-center px-3"
                                       style="border-radius: 8px; font-weight: 500;">
                                        <i class="bi bi-pencil-square me-2"></i> Edit
                                    </a>
                                    <a th:href="@{/inventories/delete/{id}(id=${inv.inventoryId})}"
                                       class="btn btn-sm btn-delete-custom d-inline-flex align-items-center px-3">
                                        <i class="bi bi-trash3 me-2"></i> Delete
                                    </a>
                                </div>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(inventories)}">
                            <td colspan="4" class="py-5 text-center">
                                <i class="bi bi-inbox text-muted opacity-25" style="font-size: 3rem;"></i>
                                <p class="text-muted mt-3">No inventory items found.</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
 
    <script src="https://cdn.jsdelivr.net"></script>
</body>
</html>
